## Multiple comparisons correction

In Neuroimaging

::: {.notes}

:::

## A typical experiment

TR

20 s on

20 s off

![Slide Image](images/slide_2_img.png)

![Slide Image](images/slide_2_img.png)

![Slide Image](images/slide_2_img.png)

![Slide Image](images/slide_2_img.png)

::: {.notes}
To help us better understand the analysis steps, let’s use an example.
Let’s say we have conducted a calssical experiment in the visual system, a flickerign checkerboard.
In this experiment, we want to find out which brain areas are active when subjects view a flickering checkerboard compared to when they view a gray background.
We have shown to every volunteer a checkerboard for e.g. 20 second interleaved with a 20 s rest, and we will measure a whole brain volume every 2 seconds, for e.g. to minutes or so.


Matlab code to generate stimulus, BOLD and shifted BOLDX = [1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0];
bf = spm_get_bf; % indicated a tr of 2.5
Y = conv(X,bf.bf);
Ye = Y+randn(size(Y)).*0.2;
:::

## A typical research question

Which areas are activated by flickering checkerboard?

::: {.notes}

:::

## A typical research question

Which areas are activated by flickering checkerboard? 
Which areas show a change in intracortical myelin
Which areas (or tracts, or tract locations) show change in FA and MD?
Which areas show a change in functional connectivity with the seed region
Which areas contain ocular dominance columns (searchlight analysis)?

MCC becomes a problem when there are no specific hypothesis about the anatomical location (region-of-interest) of your effect

::: {.notes}

:::

## Single-subject (first-level) analysis

Multivariate pattern analysis

Question: Is the voxel response pattern different in condition A and B?

![Slide Image](images/slide_5_img.png)

![Slide Image](images/slide_5_img.png)

![Slide Image](images/slide_5_img.png)

::: {.notes}
Remember that an image is 4d and consists of little 3d cubes called voxels, with the 4th diemtion being time.
A calssical analysis is done over tiem for every voxel in the brain independelty
:::

## Region of Interest analysis

Multivariate pattern analysis

Question: Is the voxel response pattern different in condition A and B?

![Slide Image](images/slide_6_img.png)

![Slide Image](images/slide_6_img.png)

![Slide Image](images/slide_6_img.png)

::: {.notes}
Remember that an image is 4d and consists of little 3d cubes called voxels, with the 4th diemtion being time.
A calssical analysis is done over tiem for every voxel in the brain independelty
:::

## Searchlight analysis

Multivariate pattern analysis

Question: Is the voxel response pattern different in condition A and B?

![Slide Image](images/slide_7_img.png)

![Slide Image](images/slide_7_img.png)

![Slide Image](images/slide_7_img.png)

::: {.notes}
Remember that an image is 4d and consists of little 3d cubes called voxels, with the 4th diemtion being time.
A calssical analysis is done over tiem for every voxel in the brain independelty
:::

## Main analysis steps in neuroimaging

::: {.notes}

:::

## Per-voxel statistical inference

t = β/SE(β)

Thresholding:
deal with the multiple comparison problem!

72,221 voxels

![Slide Image](images/slide_9_img.png)

![Slide Image](images/slide_9_img.png)

![Slide Image](images/slide_9_img.png)

::: {.notes}
How do we get from beta estimates to making statistical inference? Rejecting the null hypothesis? 
The good thing is that beta estimated devided by its standard eroor is a t-statistic with a t-distribution. So to know wheter an activation in one voxel is significant is relatively straifhtforward.
If we had just one voxel, we would have computed the t-statistic, and then depending on the degrees of freedom determined if it exceeds the critical value. 
However, we are doing the same statistical test for MANY voxels. SO the probability that we find a significant voxel simply by chance increases. This is the multiple comparison problem that is encountered anywhere in statistics. In fMRI it is particularly prominent, because the number if singe tests is enormous. 
There are several ways and philosophies for dealign with it, I won’t go into details right now. The important thing is that any voxel wise analysis MUST deal with this problem in some way.
:::

## SPM: Family-Wise Error (FWE)

“soft” Bonferroni correction
Based on Gaussian Random Field Theory
Assumes spatial Gaussian distribution voxel values
Threshold adjustment controls the probability (e.g. p<0.05 ) of  false positive blobs (“resels”) instead of false positive voxels

SPM{t}

For some more maths and explanations see:
http://imaging.mrc-cbu.cam.ac.uk/imaging/PrinciplesRandomFields#The_multiple_comparison_problem

![Slide Image](images/slide_10_img.png)

![Slide Image](images/slide_10_img.png)

![Slide Image](images/slide_10_img.png)

::: {.notes}
Determine n resels (related to smoothness, Smoothness is determined from the covariance of the residulas (remaining signal that is not modelled in your GLM))
Determine Expected Euler characteristic of an image when thresholded at different levels (EC – roughly number of blobs after thresholding, complicated formula, but depends on the number of resels)
Use Euler characteristic distribution to determine the threshold for required fals-positive probability (e.g. 0.05)

SPM likes to use a method called family-wise error correction;
In principle, it can be viewed as kind of soft bonferronly correciton, but with the way more complicated math gehind it called the gaussian random field theory.
The main idea behind this method is that a value in each voxel is not independent from it’s neigbours. And you can see that it is true, especially when the data has been smoothed, or t-map values vary smoothly across the brain volume.
So instead of figureing out the threshold such that the number of false poistive voxels is kept at a certain leve, e.g. 0.05, it tries to figure out how many false positive blobs you will get.
:::

## FS-FAST: permutation-based cluster-wise correction

True activations tend to cluster
Threshold a map at some p-value 
Generate random noise, analyze it like real data, get maximal cluster size
Repeat many times and get a distribution of maximal cluster sizes observed in noise
Compare each of your real clusters to the distribution
P(cluster) = probability of seeing a maximum cluster of that size or larger in noise

p<.0001

Unthresholded

https://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/GroupAnalysis#ClusterwiseCorrectionforMultipleComparisons

mri_glmfit-sim

![Slide Image](images/slide_11_img.png)

![Slide Image](images/slide_11_img.png)

![Slide Image](images/slide_11_img.png)

![Slide Image](images/slide_11_img.png)

::: {.notes}
FDR: proportion of false positives rather than probability of AT LEAST ONE false positive
:::

