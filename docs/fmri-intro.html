<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1&nbsp; Introduction to fMRI – Advanced Neuroimaging</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./paradigm.html" rel="next">
<link href="./overview.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./fmri-intro.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to fMRI</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./logo/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Neuroimaging</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fmri-intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to fMRI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./paradigm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experimental paradigm</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Preprocessing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">General linear model analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mcc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple comparison correction</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#fmri-study-examples" id="toc-fmri-study-examples" class="nav-link active" data-scroll-target="#fmri-study-examples">fMRI study examples</a></li>
  <li><a href="#fmri-in-comparison" id="toc-fmri-in-comparison" class="nav-link" data-scroll-target="#fmri-in-comparison">fMRI in comparison</a></li>
  <li><a href="#mri-scanner-3-tesla" id="toc-mri-scanner-3-tesla" class="nav-link" data-scroll-target="#mri-scanner-3-tesla">MRI scanner: 3 Tesla</a></li>
  <li><a href="#mri-scanner-7-tesla" id="toc-mri-scanner-7-tesla" class="nav-link" data-scroll-target="#mri-scanner-7-tesla">MRI scanner: 7 Tesla</a></li>
  <li><a href="#mri-scanner-9.4-tesla" id="toc-mri-scanner-9.4-tesla" class="nav-link" data-scroll-target="#mri-scanner-9.4-tesla">MRI scanner: 9.4 Tesla</a></li>
  <li><a href="#types-of-mri-contrasts" id="toc-types-of-mri-contrasts" class="nav-link" data-scroll-target="#types-of-mri-contrasts">Types of MRI contrasts</a></li>
  <li><a href="#t1w-in-cognitive-neuroscience" id="toc-t1w-in-cognitive-neuroscience" class="nav-link" data-scroll-target="#t1w-in-cognitive-neuroscience">T1w in cognitive neuroscience</a></li>
  <li><a href="#the-principle-of-fmri" id="toc-the-principle-of-fmri" class="nav-link" data-scroll-target="#the-principle-of-fmri">The principle of fMRI</a></li>
  <li><a href="#hemodynamic-response" id="toc-hemodynamic-response" class="nav-link" data-scroll-target="#hemodynamic-response">Hemodynamic response</a></li>
  <li><a href="#bold-signal" id="toc-bold-signal" class="nav-link" data-scroll-target="#bold-signal">BOLD signal</a></li>
  <li><a href="#t2-weighted-contrast" id="toc-t2-weighted-contrast" class="nav-link" data-scroll-target="#t2-weighted-contrast">T2*-weighted contrast</a></li>
  <li><a href="#hemodynamic-response-function" id="toc-hemodynamic-response-function" class="nav-link" data-scroll-target="#hemodynamic-response-function">Hemodynamic response function</a></li>
  <li><a href="#neural-activity-and-bold" id="toc-neural-activity-and-bold" class="nav-link" data-scroll-target="#neural-activity-and-bold">Neural activity and BOLD</a></li>
  <li><a href="#image-acquisition" id="toc-image-acquisition" class="nav-link" data-scroll-target="#image-acquisition">Image acquisition</a></li>
  <li><a href="#experimental-design" id="toc-experimental-design" class="nav-link" data-scroll-target="#experimental-design">Experimental design</a></li>
  <li><a href="#first-fmri-experiment" id="toc-first-fmri-experiment" class="nav-link" data-scroll-target="#first-fmri-experiment">First fMRI experiment</a></li>
  <li><a href="#first-fmri-experiment-1" id="toc-first-fmri-experiment-1" class="nav-link" data-scroll-target="#first-fmri-experiment-1">First fMRI experiment</a></li>
  <li><a href="#the-truly-first-fmri-experiment" id="toc-the-truly-first-fmri-experiment" class="nav-link" data-scroll-target="#the-truly-first-fmri-experiment">The truly first fMRI experiment</a></li>
  <li><a href="#a-typical-experiment" id="toc-a-typical-experiment" class="nav-link" data-scroll-target="#a-typical-experiment">A typical experiment</a></li>
  <li><a href="#d-dataset" id="toc-d-dataset" class="nav-link" data-scroll-target="#d-dataset">4D dataset</a></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a></li>
  <li><a href="#sec-analysis-steps" id="toc-sec-analysis-steps" class="nav-link" data-scroll-target="#sec-analysis-steps">Analysis steps</a></li>
  <li><a href="#single-subject-first-level-analysis" id="toc-single-subject-first-level-analysis" class="nav-link" data-scroll-target="#single-subject-first-level-analysis">Single-subject (first-level) analysis</a></li>
  <li><a href="#stimulus-function" id="toc-stimulus-function" class="nav-link" data-scroll-target="#stimulus-function">Stimulus function</a></li>
  <li><a href="#side-note-on-terminology" id="toc-side-note-on-terminology" class="nav-link" data-scroll-target="#side-note-on-terminology">Side-note on terminology</a>
  <ul class="collapse">
  <li><a href="#trial" id="toc-trial" class="nav-link" data-scroll-target="#trial">Trial</a></li>
  <li><a href="#run" id="toc-run" class="nav-link" data-scroll-target="#run">Run</a></li>
  <li><a href="#session" id="toc-session" class="nav-link" data-scroll-target="#session">Session</a></li>
  </ul></li>
  <li><a href="#voxel-time-course" id="toc-voxel-time-course" class="nav-link" data-scroll-target="#voxel-time-course">Voxel time course</a></li>
  <li><a href="#simplest-analysis-temporal-alignment" id="toc-simplest-analysis-temporal-alignment" class="nav-link" data-scroll-target="#simplest-analysis-temporal-alignment">Simplest analysis: temporal alignment</a></li>
  <li><a href="#simplest-analysis-statistical-inference" id="toc-simplest-analysis-statistical-inference" class="nav-link" data-scroll-target="#simplest-analysis-statistical-inference">Simplest analysis: statistical inference</a></li>
  <li><a href="#simplest-analysis-statistical-map" id="toc-simplest-analysis-statistical-map" class="nav-link" data-scroll-target="#simplest-analysis-statistical-map">Simplest analysis: statistical map</a></li>
  <li><a href="#general-linear-model-glm" id="toc-general-linear-model-glm" class="nav-link" data-scroll-target="#general-linear-model-glm">General Linear Model (GLM)</a></li>
  <li><a href="#buidling-regressors" id="toc-buidling-regressors" class="nav-link" data-scroll-target="#buidling-regressors">Buidling regressors</a></li>
  <li><a href="#general-linear-model" id="toc-general-linear-model" class="nav-link" data-scroll-target="#general-linear-model">General linear model</a></li>
  <li><a href="#statistical-inference-in-whole-brain-analysis" id="toc-statistical-inference-in-whole-brain-analysis" class="nav-link" data-scroll-target="#statistical-inference-in-whole-brain-analysis">Statistical inference in whole-brain analysis</a></li>
  <li><a href="#two-conditions" id="toc-two-conditions" class="nav-link" data-scroll-target="#two-conditions">Two conditions</a></li>
  <li><a href="#general-linear-model-with-two-conditions" id="toc-general-linear-model-with-two-conditions" class="nav-link" data-scroll-target="#general-linear-model-with-two-conditions">General linear model with two conditions</a></li>
  <li><a href="#contrast" id="toc-contrast" class="nav-link" data-scroll-target="#contrast">Contrast</a></li>
  <li><a href="#glm-advantages" id="toc-glm-advantages" class="nav-link" data-scroll-target="#glm-advantages">GLM advantages</a></li>
  <li><a href="#group-analysis" id="toc-group-analysis" class="nav-link" data-scroll-target="#group-analysis">Group analysis</a></li>
  <li><a href="#region-of-interest-roi-analysis" id="toc-region-of-interest-roi-analysis" class="nav-link" data-scroll-target="#region-of-interest-roi-analysis">Region-of-interest (ROI) analysis</a></li>
  <li><a href="#subcortical-rois" id="toc-subcortical-rois" class="nav-link" data-scroll-target="#subcortical-rois">Subcortical ROIs</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to fMRI</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="images/claus_7TCOR_activity_website.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Visual activity in the human claustrum <span class="citation" data-cites="coates2024">(<a href="#ref-coates2024" role="doc-biblioref">Coates et al. 2024</a>)</span></p>
</div></div><div class="notes">
<p>fMRI is a method that allows to non-invasively measure brain activity.</p>
</div>
<section id="fmri-study-examples" class="level2">
<h2 class="anchored" data-anchor-id="fmri-study-examples">fMRI study examples</h2>
<p><img src="images/clipboard-1060583024.png" class="img-fluid"></p>
<div class="notes">
<p>Many crazy studies have been performed with fMRI. Not all of the research questions really make sense!</p>
</div>
</section>
<section id="fmri-in-comparison" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="fmri-in-comparison">fMRI in comparison</h2>
<p><img src="images/clipboard-2571024653.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: Gazzaniga 5th edition, Figure 3.45</p>
</div></div><div class="notes">

</div>
</section>
<section id="mri-scanner-3-tesla" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="mri-scanner-3-tesla">MRI scanner: 3 Tesla</h2>
<p><img src="images/B2EFA5A5-4C48-420B-B1D7-6B4D7314DE12.JPG" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="https://mri-lab.uni-graz.at/" class="uri">https://mri-lab.uni-graz.at/</a></p>
</div></div><div class="notes">

</div>
</section>
<section id="mri-scanner-7-tesla" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="mri-scanner-7-tesla">MRI scanner: 7 Tesla</h2>
<p><img src="images/clipboard-2316814449.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Image source: Medical University of Vienna</p>
</div></div><div class="notes">

</div>
</section>
<section id="mri-scanner-9.4-tesla" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="mri-scanner-9.4-tesla">MRI scanner: 9.4 Tesla</h2>
<p><img src="images/20121211_MRT_MaxPlanck.jpg" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Image source: Max-Planck Institute for Biological Cybernetics, Tübingen</p>
</div></div><div class="notes">

</div>
</section>
<section id="types-of-mri-contrasts" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="types-of-mri-contrasts">Types of MRI contrasts</h2>
<p><img src="images/clipboard-4250173212.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Image source: <a href="https://en.wikipedia.org/wiki/Magnetic_resonance_imaging" class="uri">https://en.wikipedia.org/wiki/Magnetic_resonance_imaging</a></p>
</div></div></section>
<section id="t1w-in-cognitive-neuroscience" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="t1w-in-cognitive-neuroscience">T1w in cognitive neuroscience</h2>
<p><img src="images/clipboard-69158076.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Full Segmentation of a T1-weighted scan <span class="citation" data-cites="zaretskaya2018">(<a href="#ref-zaretskaya2018" role="doc-biblioref">Zaretskaya et al. 2018</a>)</span></p>
</div></div><div class="notes">
<ul>
<li><p>Displaying activity on a high-resolution anatomical scan</p></li>
<li><p>Quantitative morphometry</p>
<ul>
<li><p>Aging</p></li>
<li><p>Neurodegeneration</p></li>
<li><p>Plasticity</p></li>
</ul></li>
</ul>
</div>
</section>
<section id="the-principle-of-fmri" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-principle-of-fmri">The principle of fMRI</h2>
<p><img src="images/clipboard-1690626376.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Image source: <a href="https://www.nature.com/scitable/blog/brain-metrics/what_does_fmri_measure" class="uri">https://www.nature.com/scitable/blog/brain-metrics/what_does_fmri_measure</a></p>
</div></div><div class="notes">
<p>Hemodynamic changes: - increase in blood flow - increase in blood volume - increase in tissue CMRO_2</p>
</div>
</section>
<section id="hemodynamic-response" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="hemodynamic-response">Hemodynamic response</h2>
<p><img src="images/ezgif.com-add-text-2.gif" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: Visual Neuroscience Lab</p>
</div></div><div class="notes">

</div>
</section>
<section id="bold-signal" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="bold-signal">BOLD signal</h2>
<p>blood-oxygen-level-dependent signal</p>
<p><img src="images/clipboard-1557735976.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Hemodynamics leading to the BOLD signal <span class="citation" data-cites="interpre2009">(<a href="#ref-interpre2009" role="doc-biblioref"><span>“Interpreting the BOLD Response”</span> 2009</a>)</span></p>
</div></div><div class="notes">

</div>
</section>
<section id="t2-weighted-contrast" class="level2">
<h2 class="anchored" data-anchor-id="t2-weighted-contrast">T2*-weighted contrast</h2>
<p><img src="images/clipboard-1399733517.png" class="img-fluid"></p>
</section>
<section id="hemodynamic-response-function" class="level2">
<h2 class="anchored" data-anchor-id="hemodynamic-response-function">Hemodynamic response function</h2>
<p><img src="images/clipboard-1679437843.png" class="img-fluid"></p>
<div class="notes">
<p>This curve describes the measured signal in response to a brief stimulus.</p>
<p>The response is heavily delayed, and has a relatively complex temporal structure, described by the so called hemodynamic response function (HRF).</p>
<p>After just a brief stimulus that lasts less than a second, the response lasts for seconds. It has a delayed rise phase, a peak, and a subsequent undershoot. The fact that the response is so slow is the main constraint of the temporal resolution of fMRI. It constrains the kind of questions you can ask in your experiment and also puts some constraints on your experimental design.</p>
</div>
</section>
<section id="neural-activity-and-bold" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="neural-activity-and-bold">Neural activity and BOLD</h2>
<p><img src="images/clipboard-2104563483.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>BOLD signal correlates better with LFP than with MUA <span class="citation" data-cites="logothetis2001a">(<a href="#ref-logothetis2001a" role="doc-biblioref">Logothetis et al. 2001</a>)</span></p>
</div></div><div class="notes">
<p>LFP = Local Field Potentials (dendritic currents)</p>
<p>MUA = Multiunit Activity (action potentials)</p>
<p>SDF = Spike-density function (action potentials)</p>
</div>
</section>
<section id="image-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="image-acquisition">Image acquisition</h2>
<p><img src="images/clipboard-1936163497.png" class="img-fluid"></p>
<div class="notes">
<p>The functional volume is usually acquired slice-by-slice; this is why when you are acquiring the data you see an image like this on the monitor. A functional sequence is characterized by the in-plane matrix size and resolution, as well as by the slice thickness.</p>
</div>
</section>
<section id="experimental-design" class="level2">
<h2 class="anchored" data-anchor-id="experimental-design">Experimental design</h2>
<p><img src="images/clipboard-3076195966.png" class="img-fluid"></p>
<div class="notes">
<p>In contrast to e.g.&nbsp;fNIRS, the BOLD-fMRI does not measure the deoxyhemoglobin concentration directly. It is a measure that is weighted by the deoxyhemoglobin concentration, but depends on many other factors like scanner, sequence, participant, and brain area.</p>
<p>This is why any measure of fMRI experiment has to contain at least two conditions, a baseline, and condition of interest. The activation is always computed relative to some baseline. For instance a checkerboard vs gray background, finger tapping versus rest; faces versus houses, etc. And a typical analysis will compare the BOLD signal during condition of interest with rest.</p>
</div>
</section>
<section id="first-fmri-experiment" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="first-fmri-experiment">First fMRI experiment</h2>
<p><img src="images/clipboard-2455011416.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Brain images and statistical analysis <span class="citation" data-cites="belliveau1991">(<a href="#ref-belliveau1991" role="doc-biblioref">Belliveau et al. 1991</a>)</span></p>
</div></div><div class="notes">
<p>The first experiment was not a BOLD, but a blood volume signal measurement.</p>
</div>
</section>
<section id="first-fmri-experiment-1" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="first-fmri-experiment-1">First fMRI experiment</h2>
<p><img src="images/clipboard-460283216.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Cover of the science magazine where the paper was published <span class="citation" data-cites="belliveau1991">(<a href="#ref-belliveau1991" role="doc-biblioref">Belliveau et al. 1991</a>)</span></p>
</div></div><div class="notes">
<p>This rendering was produced specifically for the cover</p>
</div>
</section>
<section id="the-truly-first-fmri-experiment" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-truly-first-fmri-experiment">The truly first fMRI experiment</h2>
<p><img src="images/clipboard-2371383352.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Experimental setup of Angelo Mosso <span class="citation" data-cites="sandrone2013">(<a href="#ref-sandrone2013" role="doc-biblioref">Sandrone et al. 2013</a>)</span></p>
</div></div></section>
<section id="a-typical-experiment" class="level2">
<h2 class="anchored" data-anchor-id="a-typical-experiment">A typical experiment</h2>
<p><img src="images/clipboard-2847001828.png" class="img-fluid"></p>
<div class="notes">
<p>To help us better understand the analysis steps, let’s use an example. Let’s say we have conducted a classical experiment in the visual system, a flickering checkerboard. In this experiment, we want to find out which brain areas are active when subjects view a flickering checkerboard compared to when they view a gray background. We have shown to every volunteer a checkerboard for e.g.&nbsp;20 second interleaved with a 20 s rest, and we will measure a whole brain volume every 2 seconds, for e.g.&nbsp;to minutes or so.</p>
<p>Matlab code to generate stimulus, BOLD and shifted BOLD X = [1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0]; bf = spm_get_bf; % indicated a tr of 2.5 Y = conv(X,bf.bf); Ye = Y+randn(size(Y)).*0.2;</p>
</div>
</section>
<section id="d-dataset" class="level2">
<h2 class="anchored" data-anchor-id="d-dataset">4D dataset</h2>
<p><img src="images/clipboard-531340901.png" class="img-fluid"></p>
<div class="notes">
<p>In a functional experiment we usually measure brain activity across the whole volume over extended periods of time, so it is comfortable to think about each functional dataset that we acquire as a 4D dataset, which consists of 3D brain volumes and time as a 4th dimension. This is how the data is typically stored.</p>
<p>A further important parameter is the repetition time (TR). It is the time passes between the acquisition times of two adjacent volumes.</p>
</div>
</section>
<section id="preprocessing" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="preprocessing">Preprocessing</h2>
<p><img src="images/clipboard-3600520399.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Summary of preprocessing steps <span class="citation" data-cites="esteban2018">(<a href="#ref-esteban2018" role="doc-biblioref">Esteban et al. 2018</a>)</span></p>
</div></div><div class="notes">
<p>The data quality of modern scanners is typically good enough to skip this step, if your subject is compliant. But it is nevertheless very much advisable and is ALWAYS performed. We will therefore dedicate a whole session to preprocessing. See <a href="./syllabus.html#tbl-schedule">course schedule</a> for the date.</p>
</div>
</section>
<section id="sec-analysis-steps" class="level2">
<h2 class="anchored" data-anchor-id="sec-analysis-steps">Analysis steps</h2>
<ul>
<li><p>Single-subject - first level - fixed effects analysis (FFX)</p></li>
<li><p>Group - second-level - random effects analysis (RFX)</p></li>
</ul>
<div class="notes">
<p>This is equivalent to e.g.&nbsp;conducting many trials per subject to measure reaction time, and then compute a subject-specific mean per condition, after which you would perform the actual statistical inference</p>
<p>Multilevel modelling is also possible (for small datasets), but less frequent.</p>
</div>
</section>
<section id="single-subject-first-level-analysis" class="level2">
<h2 class="anchored" data-anchor-id="single-subject-first-level-analysis">Single-subject (first-level) analysis</h2>
<p>Univariate/voxel-wise analysis</p>
<p><img src="images/clipboard-3043522045.png" class="img-fluid"></p>
<p>Question: Which areas are activated by the flickering checkerboard?</p>
<div class="notes">
<p>Remember that an image is 4d and consists of little 3D cubes called voxels, with the 4th dimension being time. A classical analysis is done over time for every voxel in the brain independently.</p>
</div>
</section>
<section id="stimulus-function" class="level2">
<h2 class="anchored" data-anchor-id="stimulus-function">Stimulus function</h2>
<p><img src="images/clipboard-1888338078.png" class="img-fluid"></p>
<div class="notes">
<p>Let’s recall our checkerboard experiment where participants viewed either a checkerboard or a gray screen. Let’s also create a function, called “stimulus function”, which is one where the checkerboard was on, and zero where the checkerboard was off</p>
</div>
</section>
<section id="side-note-on-terminology" class="level2">
<h2 class="anchored" data-anchor-id="side-note-on-terminology">Side-note on terminology</h2>
<section id="trial" class="level3">
<h3 class="anchored" data-anchor-id="trial">Trial</h3>
<p>Continuous presentation of 1 experimental condition, usually 1-20 seconds</p>
</section>
<section id="run" class="level3">
<h3 class="anchored" data-anchor-id="run">Run</h3>
<p>Block of trials separated by interruption of a scanner acquisition, usually 5-10 minutes</p>
</section>
<section id="session" class="level3">
<h3 class="anchored" data-anchor-id="session">Session</h3>
<p>Block of runs, separated by subject going out of the scanner and going in again, usually at least one day</p>
</section>
</section>
<section id="voxel-time-course" class="level2">
<h2 class="anchored" data-anchor-id="voxel-time-course">Voxel time course</h2>
<p><img src="images/clipboard-1165528043.png" class="img-fluid"></p>
<div class="notes">
<p>Let’s now look at the time course of a voxel in the visual cortex. You see that it is noisy and delayed, but it kind of follows the stimulus.</p>
</div>
</section>
<section id="simplest-analysis-temporal-alignment" class="level2">
<h2 class="anchored" data-anchor-id="simplest-analysis-temporal-alignment">Simplest analysis: temporal alignment</h2>
<p><img src="images/clipboard-62469843.png" class="img-fluid"></p>
<div class="notes">
<p>The simplest analysis would be to realign the BOLD time course with the stimulus time course</p>
</div>
</section>
<section id="simplest-analysis-statistical-inference" class="level2">
<h2 class="anchored" data-anchor-id="simplest-analysis-statistical-inference">Simplest analysis: statistical inference</h2>
<p><img src="images/clipboard-3483010198.png" class="img-fluid"></p>
<div class="notes">
<p>Then labael each value according to when it was acquired, stimulus or baseline Collect two types of data points into two big piles and do a statistical comparison via a t-test</p>
</div>
</section>
<section id="simplest-analysis-statistical-map" class="level2">
<h2 class="anchored" data-anchor-id="simplest-analysis-statistical-map">Simplest analysis: statistical map</h2>
<p><img src="images/clipboard-969426715.png" class="img-fluid"></p>
<div class="notes">
<p>If you do it for every voxel, you can get a new volume, which consists of t-statistics</p>
</div>
</section>
<section id="general-linear-model-glm" class="level2">
<h2 class="anchored" data-anchor-id="general-linear-model-glm">General Linear Model (GLM)</h2>
<p>Multiple regression with ingredients:</p>
<ul>
<li><p>Predictor(s): stimulus function convolved with the HRF (see <a href="#buidling-regressors">Buidling regressors</a>)</p></li>
<li><p>Nuissance regressors</p></li>
<li><p><img src="images/sub-P01_task-localizer_run-1_design.png" class="img-fluid"></p></li>
</ul>
</section>
<section id="buidling-regressors" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="buidling-regressors">Buidling regressors</h2>
<p><img src="images/clipboard-4230244420.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Some convolution examples can be found here <span class="citation" data-cites="lindquist2008">(<a href="#ref-lindquist2008" role="doc-biblioref">Lindquist 2008</a>)</span></p>
</div></div></section>
<section id="general-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="general-linear-model">General linear model</h2>
<p><img src="images/clipboard-3283349145.png" class="img-fluid"></p>
</section>
<section id="statistical-inference-in-whole-brain-analysis" class="level2">
<h2 class="anchored" data-anchor-id="statistical-inference-in-whole-brain-analysis">Statistical inference in whole-brain analysis</h2>
<p><img src="images/clipboard-3973626449.png" class="img-fluid"></p>
<div class="notes">
<p>How do we get from beta estimates to making statistical inference? As in a typical regression, beta estimate divided by its standard error is a t-statistic with a t-distribution. So to know whether an activation in one voxel is significant is relatively straightforward.</p>
<p>If we had just one voxel, we would have computed the t-statistic, and then depending on the degrees of freedom determined if it exceeds the critical value. However, we are doing the same statistical test for MANY voxels. SO the probability that we find a significant voxel simply by chance increases. This is the multiple comparison problem that is encountered anywhere in statistics. In fMRI it is particularly prominent, because the number if singe tests is enormous. There are several ways and philosophies for dealing with it, I won’t go into details right now. The important thing is that any voxel-wise analysis MUST deal with this problem in some way.</p>
</div>
</section>
<section id="two-conditions" class="level2">
<h2 class="anchored" data-anchor-id="two-conditions">Two conditions</h2>
<p><img src="images/clipboard-3643081170.png" class="img-fluid"></p>
</section>
<section id="general-linear-model-with-two-conditions" class="level2">
<h2 class="anchored" data-anchor-id="general-linear-model-with-two-conditions">General linear model with two conditions</h2>
<p><img src="images/clipboard-632029715.png" class="img-fluid"></p>
</section>
<section id="contrast" class="level2">
<h2 class="anchored" data-anchor-id="contrast">Contrast</h2>
<p>A linear combination of beta estimates</p>
<p><img src="images/clipboard-3240858118.png" class="img-fluid"></p>
</section>
<section id="glm-advantages" class="level2">
<h2 class="anchored" data-anchor-id="glm-advantages">GLM advantages</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><img src="images/clipboard-4292960842.png" class="img-fluid"></p>
</div><div class="column" style="width:40%;">
<ul>
<li><p>Complex experimental designs</p></li>
<li><p>Discounting uninteresting effects/confounds</p></li>
<li><p>HRF shape estimation</p></li>
</ul>
</div>
</div>
</section>
<section id="group-analysis" class="level2">
<h2 class="anchored" data-anchor-id="group-analysis">Group analysis</h2>
<p><img src="images/clipboard-1995917989.png" class="img-fluid"></p>
</section>
<section id="region-of-interest-roi-analysis" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="region-of-interest-roi-analysis">Region-of-interest (ROI) analysis</h2>
<p><img src="images/clipboard-2858615543.png" class="img-fluid"></p>
<p>Question: Does the primary visual cortex respond to flickering checkerboards?</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>HCP cortical parcellation (“Glasser atlas”) <span class="citation" data-cites="glasser2016">(<a href="#ref-glasser2016" role="doc-biblioref">Glasser et al. 2016</a>)</span></p>
</div></div><div class="notes">
<p>ROI analysis is a way to deal with multiple comparison problem. But it requires an a priory and independent definition of an ROI.</p>
<p>There are two ways to define ROIs:</p>
<ul>
<li><p>From an anatomical scan</p></li>
<li><p>From an additional (separate) functional experiment</p></li>
</ul>
</div>
</section>
<section id="subcortical-rois" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="subcortical-rois">Subcortical ROIs</h2>
<p><img src="images/next_brain_coronal.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>NextBrain parcellation containing 333 anatomical structures <span class="citation" data-cites="casamitjana2024">(<a href="#ref-casamitjana2024" role="doc-biblioref">Casamitjana et al. 2024</a>)</span></p>
</div></div><div class="notes">
<p>This is the state-of-the-art for anatomically-based ROI definition based on deep learning</p>
</div>
</section>
<section id="references" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-belliveau1991" class="csl-entry" role="listitem">
Belliveau, J. W., D. N. Kennedy, R. C. McKinstry, B. R. Buchbinder, R. M. Weisskoff, M. S. Cohen, J. M. Vevea, T. J. Brady, and B. R. Rosen. 1991. <span>“Functional Mapping of the Human Visual Cortex by Magnetic Resonance Imaging.”</span> <em>Science</em> 254 (5032): 716–19. <a href="https://doi.org/10.1126/science.1948051">https://doi.org/10.1126/science.1948051</a>.
</div>
<div id="ref-casamitjana2024" class="csl-entry" role="listitem">
Casamitjana, Adrià, Matteo Mancini, Eleanor Robinson, Loïc Peter, Roberto Annunziata, Juri Althonayan, Shauna Crampsie, et al. 2024. <span>“A Next-Generation, Histological Atlas of the Human Brain and Its Application to Automated Brain MRI Segmentation.”</span> <a href="http://dx.doi.org/10.1101/2024.02.05.579016">http://dx.doi.org/10.1101/2024.02.05.579016</a>.
</div>
<div id="ref-coates2024" class="csl-entry" role="listitem">
Coates, Adam, David Linhardt, Christian Windischberger, Anja Ischebeck, and Natalia Zaretskaya. 2024. <span>“High-Resolution 7T fMRI Reveals the Visual Zone of the Human Claustrum.”</span> <em>Imaging Neuroscience</em> 2: 1–15. <a href="https://doi.org/10.1162/imag_a_00327">https://doi.org/10.1162/imag_a_00327</a>.
</div>
<div id="ref-esteban2018" class="csl-entry" role="listitem">
Esteban, Oscar, Christopher J. Markiewicz, Ross W. Blair, Craig A. Moodie, A. Ilkay Isik, Asier Erramuzpe, James D. Kent, et al. 2018. <span>“fMRIPrep: A Robust Preprocessing Pipeline for Functional MRI.”</span> <em>Nature Methods</em> 16 (1): 111–16. <a href="https://doi.org/10.1038/s41592-018-0235-4">https://doi.org/10.1038/s41592-018-0235-4</a>.
</div>
<div id="ref-glasser2016" class="csl-entry" role="listitem">
Glasser, Matthew F., Timothy S. Coalson, Emma C. Robinson, Carl D. Hacker, John Harwell, Essa Yacoub, Kamil Ugurbil, et al. 2016. <span>“A Multi-Modal Parcellation of Human Cerebral Cortex.”</span> <em>Nature</em> 536 (7615): 171–78. <a href="https://doi.org/10.1038/nature18933">https://doi.org/10.1038/nature18933</a>.
</div>
<div id="ref-interpre2009" class="csl-entry" role="listitem">
<span>“Interpreting the BOLD Response.”</span> 2009. In, 400–424. Cambridge University Press. <a href="https://doi.org/10.1017/cbo9780511605505.020">https://doi.org/10.1017/cbo9780511605505.020</a>.
</div>
<div id="ref-lindquist2008" class="csl-entry" role="listitem">
Lindquist, Martin A. 2008. <span>“The Statistical Analysis of fMRI Data.”</span> <em>Statistical Science</em> 23 (4). <a href="https://doi.org/10.1214/09-sts282">https://doi.org/10.1214/09-sts282</a>.
</div>
<div id="ref-logothetis2001a" class="csl-entry" role="listitem">
Logothetis, Nikos K., Jon Pauls, Mark Augath, Torsten Trinath, and Axel Oeltermann. 2001. <span>“Neurophysiological Investigation of the Basis of the fMRI Signal.”</span> <em>Nature</em> 412 (6843): 150–57. <a href="https://doi.org/10.1038/35084005">https://doi.org/10.1038/35084005</a>.
</div>
<div id="ref-sandrone2013" class="csl-entry" role="listitem">
Sandrone, Stefano, Marco Bacigaluppi, Marco R. Galloni, Stefano F. Cappa, Andrea Moro, Marco Catani, Massimo Filippi, Martin M. Monti, Daniela Perani, and Gianvito Martino. 2013. <span>“Weighing Brain Activity with the Balance: Angelo Mosso<span>’</span>s Original Manuscripts Come to Light.”</span> <em>Brain</em> 137 (2): 621–33. <a href="https://doi.org/10.1093/brain/awt091">https://doi.org/10.1093/brain/awt091</a>.
</div>
<div id="ref-zaretskaya2018" class="csl-entry" role="listitem">
Zaretskaya, Natalia, Bruce Fischl, Martin Reuter, Ville Renvall, and Jonathan R Polimeni. 2018. <span>“Advantages of Cortical Surface Reconstruction Using Submillimeter 7 t MEMPRAGE.”</span> <em>NeuroImage</em> 165 (January): 11–26. <a href="https://doi.org/10.1016/j.neuroimage.2017.09.060">https://doi.org/10.1016/j.neuroimage.2017.09.060</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./overview.html" class="pagination-link" aria-label="Course overview">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Course overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./paradigm.html" class="pagination-link" aria-label="Experimental paradigm">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experimental paradigm</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>