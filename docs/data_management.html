<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Data management – Advanced Neuroimaging</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./paradigm.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data_management.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data management</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./logo/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Neuroimaging</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fmri-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to fMRI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./paradigm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experimental paradigm</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_management.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data management</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#general" id="toc-general" class="nav-link active" data-scroll-target="#general">General</a></li>
  <li><a href="#state-in-2022" id="toc-state-in-2022" class="nav-link" data-scroll-target="#state-in-2022">State in 2022</a></li>
  <li><a href="#bids" id="toc-bids" class="nav-link" data-scroll-target="#bids">BIDS</a></li>
  <li><a href="#psychopy" id="toc-psychopy" class="nav-link" data-scroll-target="#psychopy">1. Psychopy</a>
  <ul class="collapse">
  <li><a href="#bids-plugin-for-psychopy" id="toc-bids-plugin-for-psychopy" class="nav-link" data-scroll-target="#bids-plugin-for-psychopy">BIDS plugin for PsychoPy</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  </ul></li>
  <li><a href="#experiment-adjustmentdata_management-1" id="toc-experiment-adjustmentdata_management-1" class="nav-link" data-scroll-target="#experiment-adjustmentdata_management-1">Experiment adjustment</a>
  <ul class="collapse">
  <li><a href="#thanks-to" id="toc-thanks-to" class="nav-link" data-scroll-target="#thanks-to">Thanks to</a></li>
  <li><a href="#properties" id="toc-properties" class="nav-link" data-scroll-target="#properties">Properties</a></li>
  <li><a href="#renaming" id="toc-renaming" class="nav-link" data-scroll-target="#renaming">Renaming?</a>
  <ul class="collapse">
  <li><a href="#file" id="toc-file" class="nav-link" data-scroll-target="#file">File</a></li>
  <li><a href="#project-folder" id="toc-project-folder" class="nav-link" data-scroll-target="#project-folder">Project folder</a></li>
  </ul></li>
  <li><a href="#research-question" id="toc-research-question" class="nav-link" data-scroll-target="#research-question">Research question</a>
  <ul class="collapse">
  <li><a href="#what-information-do-we-actually-need-for-analysis" id="toc-what-information-do-we-actually-need-for-analysis" class="nav-link" data-scroll-target="#what-information-do-we-actually-need-for-analysis">What information do we actually need for analysis?</a></li>
  </ul></li>
  <li><a href="#unique-conditions" id="toc-unique-conditions" class="nav-link" data-scroll-target="#unique-conditions">Unique conditions</a></li>
  <li><a href="#trials.xlsx" id="toc-trials.xlsx" class="nav-link" data-scroll-target="#trials.xlsx">trials.xlsx</a></li>
  <li><a href="#side-note" id="toc-side-note" class="nav-link" data-scroll-target="#side-note">Side note:</a>
  <ul class="collapse">
  <li><a href="#ideal-paradigm" id="toc-ideal-paradigm" class="nav-link" data-scroll-target="#ideal-paradigm">Ideal paradigm</a></li>
  </ul></li>
  <li><a href="#events-of-interest-in-a-trial" id="toc-events-of-interest-in-a-trial" class="nav-link" data-scroll-target="#events-of-interest-in-a-trial">Events of interest in a trial</a>
  <ul class="collapse">
  <li><a href="#gamble_trial-or-gamble_outcome" id="toc-gamble_trial-or-gamble_outcome" class="nav-link" data-scroll-target="#gamble_trial-or-gamble_outcome">gamble_trial or gamble_outcome?</a></li>
  <li><a href="#do-we-need-key-presses" id="toc-do-we-need-key-presses" class="nav-link" data-scroll-target="#do-we-need-key-presses">Do we need key presses?</a></li>
  </ul></li>
  <li><a href="#adding-bids-events" id="toc-adding-bids-events" class="nav-link" data-scroll-target="#adding-bids-events">Adding bids events</a>
  <ul class="collapse">
  <li><a href="#scanner-trigger" id="toc-scanner-trigger" class="nav-link" data-scroll-target="#scanner-trigger">Scanner trigger</a></li>
  </ul></li>
  <li><a href="#linking-to-a-routine-1" id="toc-linking-to-a-routine-1" class="nav-link" data-scroll-target="#linking-to-a-routine-1">Linking to a routine # 1</a></li>
  <li><a href="#linking-to-a-routine-2" id="toc-linking-to-a-routine-2" class="nav-link" data-scroll-target="#linking-to-a-routine-2">Linking to a routine #2</a></li>
  <li><a href="#adding-bids-events-of-interest" id="toc-adding-bids-events-of-interest" class="nav-link" data-scroll-target="#adding-bids-events-of-interest">Adding bids events of interest</a>
  <ul class="collapse">
  <li><a href="#new-variable-outcome_trial" id="toc-new-variable-outcome_trial" class="nav-link" data-scroll-target="#new-variable-outcome_trial">New variable outcome_trial</a></li>
  </ul></li>
  <li><a href="#points_text" id="toc-points_text" class="nav-link" data-scroll-target="#points_text">points_text</a></li>
  <li><a href="#time-stamp" id="toc-time-stamp" class="nav-link" data-scroll-target="#time-stamp">Time stamp</a>
  <ul class="collapse">
  <li><a href="#time-0---scanning-onset" id="toc-time-0---scanning-onset" class="nav-link" data-scroll-target="#time-0---scanning-onset">Time 0 - scanning onset</a></li>
  </ul></li>
  <li><a href="#other-events" id="toc-other-events" class="nav-link" data-scroll-target="#other-events">Other events</a></li>
  <li><a href="#bids-export" id="toc-bids-export" class="nav-link" data-scroll-target="#bids-export">BIDS export</a></li>
  <li><a href="#complete-bids-dataset" id="toc-complete-bids-dataset" class="nav-link" data-scroll-target="#complete-bids-dataset">Complete BIDS dataset</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dicom-to-bids" id="toc-dicom-to-bids" class="nav-link" data-scroll-target="#dicom-to-bids">2. DICOM to BIDS</a>
  <ul class="collapse">
  <li><a href="#neurodesk" id="toc-neurodesk" class="nav-link" data-scroll-target="#neurodesk">Neurodesk</a></li>
  <li><a href="#mri-data-formats" id="toc-mri-data-formats" class="nav-link" data-scroll-target="#mri-data-formats">MRI data formats</a></li>
  <li><a href="#bidscoin" id="toc-bidscoin" class="nav-link" data-scroll-target="#bidscoin">bidscoin</a></li>
  <li><a href="#shell-commands" id="toc-shell-commands" class="nav-link" data-scroll-target="#shell-commands">Shell commands</a></li>
  <li><a href="#bismapper" id="toc-bismapper" class="nav-link" data-scroll-target="#bismapper">bismapper</a></li>
  <li><a href="#subject-and-session" id="toc-subject-and-session" class="nav-link" data-scroll-target="#subject-and-session">Subject and session</a></li>
  <li><a href="#editing-file-names-anatomical" id="toc-editing-file-names-anatomical" class="nav-link" data-scroll-target="#editing-file-names-anatomical">Editing file names: anatomical</a></li>
  <li><a href="#editing-file-names-functional" id="toc-editing-file-names-functional" class="nav-link" data-scroll-target="#editing-file-names-functional">Editing file names: functional</a></li>
  <li><a href="#view-files" id="toc-view-files" class="nav-link" data-scroll-target="#view-files">View files</a></li>
  <li><a href="#mricron" id="toc-mricron" class="nav-link" data-scroll-target="#mricron">MRICron</a></li>
  </ul></li>
  <li><a href="#quality-assurance" id="toc-quality-assurance" class="nav-link" data-scroll-target="#quality-assurance">3. Quality assurance</a>
  <ul class="collapse">
  <li><a href="#mriqc" id="toc-mriqc" class="nav-link" data-scroll-target="#mriqc">MRIQC</a></li>
  <li><a href="#run" id="toc-run" class="nav-link" data-scroll-target="#run">Run</a>
  <ul class="collapse">
  <li><a href="#command-line" id="toc-command-line" class="nav-link" data-scroll-target="#command-line">Command line</a></li>
  <li><a href="#output" id="toc-output" class="nav-link" data-scroll-target="#output">Output</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data management</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In neuroimaging</p>
<section id="general" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="general">General</h2>
<p><img src="images/clipboard-3125101888.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><span class="citation" data-cites="juavinett2022">(<a href="#ref-juavinett2022" role="doc-biblioref">Juavinett 2022</a>)</span></p>
</div></div></section>
<section id="state-in-2022" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="state-in-2022">State in 2022</h2>
<p><img src="images/clipboard-572345686.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Image credit: <span class="citation" data-cites="juavinett2022">(<a href="#ref-juavinett2022" role="doc-biblioref">Juavinett 2022</a>)</span></p>
</div></div></section>
<section id="bids" class="level2">
<h2 class="anchored" data-anchor-id="bids">BIDS</h2>
<iframe width="780" height="500" src="https://bids.neuroimaging.io/index.html" title="BIDS official website"></iframe>
<p><img src="images/clipboard-4264973894.png" class="img-fluid"></p>
</section>
<section id="psychopy" class="level1 page-columns page-full">
<h1>1. Psychopy</h1>
<section id="bids-plugin-for-psychopy" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="bids-plugin-for-psychopy">BIDS plugin for PsychoPy</h2>
<p>Should be installed and enabled to save events (conditions and button presses) in a comprehensive and standardized manner.</p>
<p><img src="images/clipboard-4271384204.png" class="img-fluid"></p>
<p>This will also make our data analysis easier</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="https://psychopy-bids.readthedocs.io/en/stable/" class="uri">https://psychopy-bids.readthedocs.io/en/stable/</a></p>
</div></div></section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p><img src="images/clipboard-3969700235.png" class="img-fluid"></p>
<div class="notes">
<p>Open psychopy and press “Get more” on the right side. Alternatively you can open “plugin/pachages manager” via “Tools” menue. Psychopy-plugin should be listed among the available plugins.</p>
<p>On the university computers, bids plugin is available through software center.</p>
</div>
</section>
</section>
<section id="experiment-adjustmentdata_management-1" class="level1">
<h1>Experiment adjustment<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h1>
<section id="thanks-to" class="level2">
<h2 class="anchored" data-anchor-id="thanks-to">Thanks to</h2>
<p><img src="images/clipboard-3961870448.png" class="img-fluid"></p>
<p>Lukas currently took over the BIDS plugin development.</p>
</section>
<section id="properties" class="level2">
<h2 class="anchored" data-anchor-id="properties">Properties</h2>
<p><img src="images/clipboard-3648775932.png" class="img-fluid"></p>
<div class="notes">
<ol type="1">
<li>Experiment name will correspond to the task-[taskname] properety in the bids dataset. It is therefore useful to have a short name without capital letters. This did not work on my mac, but maybe this is an OS issue?</li>
<li>Participant: switched from random code generator to 001. Since we keep the naming consistent with the MRI dataset, and have multiple runs, it is not useful to generate a new code on every run repetition</li>
<li>Session: changed from 001 to 1. This is just our naming convention. Nobody has hundreds of sessions, so we do not expect a number with more than two digits.</li>
</ol>
</div>
</section>
<section id="renaming" class="level2">
<h2 class="anchored" data-anchor-id="renaming">Renaming?</h2>
<section id="file" class="level3">
<h3 class="anchored" data-anchor-id="file">File</h3>
<p><img src="images/clipboard-2219598044.png" class="img-fluid"></p>
</section>
<section id="project-folder" class="level3">
<h3 class="anchored" data-anchor-id="project-folder">Project folder</h3>
<p><img src="images/clipboard-1865608280.png" class="img-fluid"></p>
<div class="notes">
<p>For the task label to work properly in the BIDS plugin, I also tried renaming the experiment file and the folder, but this did not help. Gambling is still spelled out with a capital “G” no mater what I do. Let’s stay tuned for the psychopy-bids updates.</p>
</div>
</section>
</section>
<section id="research-question" class="level2">
<h2 class="anchored" data-anchor-id="research-question">Research question</h2>
<section id="what-information-do-we-actually-need-for-analysis" class="level3">
<h3 class="anchored" data-anchor-id="what-information-do-we-actually-need-for-analysis">What information do we actually need for analysis?</h3>
<p><img src="images/clipboard-1090987086.png" class="img-fluid"></p>
<div class="notes">
<p>We should keep the research question in mind.</p>
<p>H1 is formulated as a one-way ANOVA with three pairwise post-hoc tests</p>
<p>H2 is formulated as 2x2 two-way ANOVA (at least we will simplify it to that)</p>
</div>
</section>
</section>
<section id="unique-conditions" class="level2">
<h2 class="anchored" data-anchor-id="unique-conditions">Unique conditions</h2>
<ul>
<li><p>small win</p></li>
<li><p>small loss</p></li>
<li><p>large win</p></li>
<li><p>large loss</p></li>
<li><p>pass</p></li>
</ul>
</section>
<section id="trials.xlsx" class="level2">
<h2 class="anchored" data-anchor-id="trials.xlsx">trials.xlsx</h2>
<p><img src="images/clipboard-752105472.png" class="img-fluid"></p>
<div class="notes">
<p>For every trial, we should be able to identify whether it is win, loss or pass.</p>
<p>For every win or loss trial, we need to know if it is a win/loss with high stakes or with low stakes.</p>
<p>Note: right now we are not taking the win probability into account, but we know that it is always low for large stakes, and large for low stakes, so it is redundant.</p>
</div>
</section>
<section id="side-note" class="level2">
<h2 class="anchored" data-anchor-id="side-note">Side note:</h2>
<section id="ideal-paradigm" class="level3">
<h3 class="anchored" data-anchor-id="ideal-paradigm">Ideal paradigm</h3>
<ul>
<li><p>Each trial type appears the same number of times</p></li>
<li><p>Carryover counterbalancing - each condition is equally likely to be preceded by each other condition <span class="citation" data-cites="brooks2012">(<a href="#ref-brooks2012" role="doc-biblioref">Brooks 2012</a>)</span></p></li>
</ul>
</section>
</section>
<section id="events-of-interest-in-a-trial" class="level2">
<h2 class="anchored" data-anchor-id="events-of-interest-in-a-trial">Events of interest in a trial</h2>
<section id="gamble_trial-or-gamble_outcome" class="level3">
<h3 class="anchored" data-anchor-id="gamble_trial-or-gamble_outcome">gamble_trial or gamble_outcome?</h3>
<p><img src="images/clipboard-3778340065.png" class="img-fluid"></p>
</section>
<section id="do-we-need-key-presses" class="level3">
<h3 class="anchored" data-anchor-id="do-we-need-key-presses">Do we need key presses?</h3>
</section>
</section>
<section id="adding-bids-events" class="level2">
<h2 class="anchored" data-anchor-id="adding-bids-events">Adding bids events</h2>
<section id="scanner-trigger" class="level3">
<h3 class="anchored" data-anchor-id="scanner-trigger">Scanner trigger</h3>
<p><img src="images/clipboard-3535149556.png" class="img-fluid"></p>
<p>I am not sure if it is needed after all, but I added a bids component to a routine that waits 10 seconds after the scanner trigger and logged its onset.</p>
</section>
</section>
<section id="linking-to-a-routine-1" class="level2">
<h2 class="anchored" data-anchor-id="linking-to-a-routine-1">Linking to a routine # 1</h2>
<p><img src="images/clipboard-2395359737.png" class="img-fluid"></p>
<div class="notes">
<p>In the BIDS Event Type field you can choose between TaskEvent and BehEvent. For now the difference does not matter much, let’s choose task event.</p>
</div>
</section>
<section id="linking-to-a-routine-2" class="level2">
<h2 class="anchored" data-anchor-id="linking-to-a-routine-2">Linking to a routine #2</h2>
<p><img src="images/clipboard-674558866.png" class="img-fluid"></p>
<p>Right now time 0 in our experiment is the start of the welcome screen. We want time 0 to be the scanner trigger. Will take care of it later.</p>
</section>
<section id="adding-bids-events-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="adding-bids-events-of-interest">Adding bids events of interest</h2>
<section id="new-variable-outcome_trial" class="level3">
<h3 class="anchored" data-anchor-id="new-variable-outcome_trial">New variable outcome_trial</h3>
<p>We need one variable to take 3 possible outcomes: win, loss or pass. Therefore, I adjusted the code, adding a variable “outcome_trial” for this purpose.</p>
<p><img src="images/clipboard-347898199.png" class="img-fluid"></p>
</section>
</section>
<section id="points_text" class="level2">
<h2 class="anchored" data-anchor-id="points_text">points_text</h2>
<p><img src="images/clipboard-182415314.png" class="img-fluid"></p>
<div class="notes">
<p>We are creating a bids event and linking it to points_text within the trial (because this routine appears on every loop interation).</p>
</div>
</section>
<section id="time-stamp" class="level2">
<h2 class="anchored" data-anchor-id="time-stamp">Time stamp</h2>
<section id="time-0---scanning-onset" class="level3">
<h3 class="anchored" data-anchor-id="time-0---scanning-onset">Time 0 - scanning onset</h3>
<p><img src="images/clipboard-3405507570.png" class="img-fluid"></p>
<div class="notes">
<p>Now we want to adjust the onset time to the scanner trigger arrival. This is done by ticking “Manually set values” and putting the difference between the onset of the current routine and the start of the blank period.</p>
<p>It would have been better and more accurate to subtract the actually key press time, but I ran out of time.</p>
</div>
</section>
</section>
<section id="other-events" class="level2">
<h2 class="anchored" data-anchor-id="other-events">Other events</h2>
<p><img src="images/clipboard-3834157527.png" class="img-fluid"></p>
<div class="notes">
<p>Here I added two other bids events that may or may not be useful, just in case: Trial onset and key press, including reaction times.</p>
</div>
</section>
<section id="bids-export" class="level2">
<h2 class="anchored" data-anchor-id="bids-export">BIDS export</h2>
<p><img src="images/clipboard-1613912465.png" class="img-fluid"></p>
<p>It is important to add the bidsExport routine at the end of the experiment.</p>
<ol type="1">
<li>For fMRI, the data type should be “func”</li>
<li>Choose. your favourite license</li>
<li>Tick the box “Add Run Nubmers” - this should attach run numbers to the file names in bids format for every new run. I did not get it to work properly on mac (it was always run 1, overwriting the previous file). But supposedly it works on windows and linux.</li>
</ol>
</section>
<section id="complete-bids-dataset" class="level2">
<h2 class="anchored" data-anchor-id="complete-bids-dataset">Complete BIDS dataset</h2>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p><img src="images/clipboard-806437960.png" class="img-fluid"></p>
<div class="notes">
<p>This is how a complete dataset for fmri analysis should look like. You should have functional _bold.nii.gz files and _events.tsv files in one func/ folder.</p>
</div>
</section>
</section>
</section>
<section id="dicom-to-bids" class="level1">
<h1>2. DICOM to BIDS</h1>
<section id="neurodesk" class="level2">
<h2 class="anchored" data-anchor-id="neurodesk">Neurodesk</h2>
<p><img src="images/clipboard-3392567157.png" class="img-fluid"></p>
</section>
<section id="mri-data-formats" class="level2">
<h2 class="anchored" data-anchor-id="mri-data-formats">MRI data formats</h2>
<ul>
<li><p>DICOM - medical image format</p>
<ul>
<li>.dcm .ima or nothing at all</li>
</ul></li>
<li><p>NIFTI - neuroimaging format we work with</p>
<ul>
<li>.nii or .nii.gz</li>
</ul></li>
</ul>
</section>
<section id="bidscoin" class="level2">
<h2 class="anchored" data-anchor-id="bidscoin">bidscoin</h2>
<p><img src="images/clipboard-404437105.png" class="img-fluid"></p>
</section>
<section id="shell-commands" class="level2">
<h2 class="anchored" data-anchor-id="shell-commands">Shell commands</h2>
<p><img src="images/clipboard-1623492321.png" class="img-fluid"></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># you can copypaste the following commands into the terminal window that is opened by BIDSCOINER</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define directories</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="va">sourceFolder</span><span class="op">=</span>/home/jovyan/completion2/dcm</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="va">sortedFolder</span><span class="op">=</span>/home/jovyan/completion2/dcm_sorted</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output of the source folder</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> <span class="va">$sourceFolder</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># make the target directory with subdirectories</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$sortedFolder</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># change to the script folder</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/jovyan/dicomsort/</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># run the script</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">./DICOMsort.sh</span> <span class="va">$sourceFolder</span> <span class="va">$sortedFolder</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># check the output of the target folder</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> <span class="va">$sortedFolder</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># run bidsmapper</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="ex">bidsmapper</span> <span class="va">$sortedFolder</span> /home/jovyan/completion2/bids</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># note: in the intendedFor of the fieldmap, add func/sub-001_ses-1_xxx_bold.*</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># once you are happy with the mapping, run bidscoiner</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="ex">bidscoiner</span> <span class="va">$sortedFolder</span> /home/jovyan/completion2/bids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bismapper" class="level2">
<h2 class="anchored" data-anchor-id="bismapper">bismapper</h2>
<p><img src="images/clipboard-3995624064.png" class="img-fluid" style="width:32.0%"></p>
<p>Currently, to discover the data we need to delete the content of the “subprefix” field and then save the bids map in the default location. After this, run the same bidsmapper command again.</p>
</section>
<section id="subject-and-session" class="level2">
<h2 class="anchored" data-anchor-id="subject-and-session">Subject and session</h2>
<p><img src="images/clipboard-325791456.png" class="img-fluid" style="width:50.0%"></p>
<p>Now the bidsmapper discovered everything, but the files are not named correctly.</p>
<p>Edit subject and session first.</p>
<p>Now we need to rename the files by clicking “Edit” next to every file.</p>
</section>
<section id="editing-file-names-anatomical" class="level2">
<h2 class="anchored" data-anchor-id="editing-file-names-anatomical">Editing file names: anatomical</h2>
<p><img src="images/clipboard-1483139836.png" class="img-fluid" style="width:50.0%"></p>
<p>anatmprage -&gt; mprage in the “acq” filed</p>
</section>
<section id="editing-file-names-functional" class="level2">
<h2 class="anchored" data-anchor-id="editing-file-names-functional">Editing file names: functional</h2>
<p><img src="images/clipboard-103624418.png" class="img-fluid" style="width:50.0%"></p>
<p>Edit the task name and acq field</p>
<p>Do this for every functional file</p>
<p>In the intendedFor of the fieldmap, add “func/sub-999_ses-1_task-completion_acq–noise_bold.*” with a wildcard. This will select all respective functional runs</p>
<p>Once you are happy, run bidscoiner to do the actual conversion</p>
</section>
<section id="view-files" class="level2">
<h2 class="anchored" data-anchor-id="view-files">View files</h2>
<p><img src="images/clipboard-3124758617.png" class="img-fluid"></p>
</section>
<section id="mricron" class="level2">
<h2 class="anchored" data-anchor-id="mricron">MRICron</h2>
<p><img src="images/clipboard-2244027224.png" class="img-fluid" width="446"></p>
<p>Now you can view the nifti files with any suitable software</p>
</section>
</section>
<section id="quality-assurance" class="level1">
<h1>3. Quality assurance</h1>
<section id="mriqc" class="level2">
<h2 class="anchored" data-anchor-id="mriqc">MRIQC</h2>
<p>MRIQC is a tool used for quality assurance of bids-valid datasets</p>
<p><img src="images/clipboard-1260990723.png" class="img-fluid"></p>
</section>
<section id="run" class="level2">
<h2 class="anchored" data-anchor-id="run">Run</h2>
<section id="command-line" class="level3">
<h3 class="anchored" data-anchor-id="command-line">Command line</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="va">bids_folder</span><span class="op">=</span>/home/jovyan/completion2/bids/</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="va">mriqc_folder</span><span class="op">=</span>/home/jovyan/completion2/bids/derivatives/mriqc/</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">mriqc</span> <span class="va">$bids_folder</span> <span class="va">$mriqc_folder</span> participant <span class="at">--participant-label</span> 999</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="output" class="level3">
<h3 class="anchored" data-anchor-id="output">Output</h3>
<p><img src="images/clipboard-659925537.png" class="img-fluid"></p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-brooks2012" class="csl-entry" role="listitem">
Brooks, Joseph L. 2012. <span>“Counterbalancing for Serial Order Carryover Effects in Experimental Condition Orders.”</span> <em>Psychological Methods</em> 17 (4): 600–614. <a href="https://doi.org/10.1037/a0029310">https://doi.org/10.1037/a0029310</a>.
</div>
<div id="ref-juavinett2022" class="csl-entry" role="listitem">
Juavinett, Ashley L. 2022. <span>“The Next Generation of Neuroscientists Needs to Learn How to Code, and We Need New Ways to Teach Them.”</span> <em>Neuron</em> 110 (4): 576–78. <a href="https://doi.org/10.1016/j.neuron.2021.12.001">https://doi.org/10.1016/j.neuron.2021.12.001</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>valid for PsychoPy v2024.2.4<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./paradigm.html" class="pagination-link" aria-label="Experimental paradigm">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Experimental paradigm</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>